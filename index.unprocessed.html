<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Initializing Application...</title>
    <script src="dist/elm.js"></script>
  </head>
  <!-- Set the background color here, to the color of your app. -->
  <body style="background-color: rgb(248, 253, 252);">
    <script>
      /**
       * Extract a value from a cookie name.
       */
      function getCookieValue(name) {
        const cookie = document.cookie.match(
          "(^|[^;]+)\\s*" + name + "\\s*=\\s*([^;]+)"
        );
        return cookie ? cookie.pop() : null;
      }
      /**
       * Try to get the browser language, falling back to English.
       */
      function getBrowserLanguage() {
        if (navigator) {
          return navigator.languages && navigator.languages.length
            ? navigator.languages[0]
            : navigator.language || navigator.userLanguage;
        }
        console.warn("[getBrowserLanguage] Navigator not supported");
        return "en-US";
      }
      /**
       * Select a language from the available options.
       */
      function selectLanguage() {
        const languageCookie = getCookieValue("i18next222");
        const languageBrowser = getBrowserLanguage();
        if (languageCookie) {
          return languageCookie;
        }
        return languageBrowser;
      }

      /**
       * Fetch translations and supported languages.
       */
      const fetchTranslations = new Promise(function(resolve, reject) {
        const selectedLanguage = selectLanguage();
        // This information should be fetched from a server.
        const supportedLanguages = ["en", "da", "fr"];
        const fakeTranslations = {
          title: {
            item: "Item!",
            notFound: "Not Found!"
          },
          shared: {
            textToReverse: "Text To Reverse",
            reverseText: "Reverse Text"
          }
        };
        // Simulate loading time.
        setTimeout(function() {
          resolve({
            selectedLanguage,
            supportedLanguages,
            translations: fakeTranslations
          });
        }, 500);
      });

      const accessToken = getCookieValue("accessToken");
      const apiUrl = process.env.API_URL; // "https://api.github.com/graphql"
      const stage = process.env.STAGE; // "development"

      /**
       * Start the Elm app when translations have downloaded.
       */
      fetchTranslations.then(function(i18n) {
        const app = Elm.Main.init({
          flags: {
            stage,
            apiUrl,
            accessToken,
            i18n
          }
        });
      });
    </script>
  </body>
</html>
